# get-attendance

This is a simple Python script for teachers using Microsoft Teams. It gathers the data from attendance lists and attendance reports generated by Microsoft Teams. It is well suited to classes that take place at more-or-less fixed times during the week. You need a recent Python interpreter to use it. I wrote this script for myself, and I am sharing it so others can possibly benefit from it.

Teams has a nice feature of attendance lists/reports, but, robust as it is, it contains too much information for teachers. Like who joined when, and then left, and this data is scattered across many files. If your class has 15 meetings in a semester, you would get 15 reports. This script can read data from all those reports and lay it out smartly in sheets in CSV format that can be opened in a spreadsheet app:

    Full name,2021-03-04,2021-03-25,2021-04-08
    Eleanor Someone,1,1,1
    Joan Someoneelse,0,1,0
    Daniel Whoever,0,0,1

Here 0 means 'absent' and 1 means 'present'. One sheet per class.

You need to provide a schedule file that lists the classes that you teach, formatted like this:

    Wednesday, 9:00, Linear algebra group 1
    Wednesday, 11:00, Linear algebra group 2
    Thursday, 9:00, Topology
    Thursday, 11:00, Topology
    Friday, 13:00, Linear algebra group 1
    Friday, 15:00, Linear algebra group 2

It should be named **schedule.csv** and placed in the same directory as the script. (You will even /get some assistance/ creating it, see below). The last column should contain readable names of your classes, uniquely identifying each group that you teach. These names are also used as **file names for the sheets**.

Say, you have an attendance list/report in your Downloads directory from a meeting that started on Wednesday at 8:55. The meeting start time will be matched to the closest one in your schedule. Accordingly, the attendance in the list/report will go to the file **Linear algebra group 1.csv** in the current directory. 

No attempt is made to check if the student spent 1 minute or 90 minutes at the meeting. If you need such checks, you can modify the script yourself.

## Usage

### 1. Get attendance lists or reports.

During a Teams meeting that you organized, click on the **...** icon and download the list of participants.

Or, after the meeting, find the attendance report and download it.

In either case the file should be saved in your Downloads directory with a name like 'meetingAttendanceList (9).csv' or 'meetingAttendanceReport(General) (4).csv'. It is assumed that:
* every attendance list (downloaded during the meeting) contains 'meetingAttendanceList' in the name, and
* every attendance report (downloaded from the chat, after the meeting) contains 'meetingAttendanceReport' in the name.

You may have multiple such files in your Downloads directory.

### 2. Download the script 'attendance.py' and edit the settings in the script file.

You should only have to do this once. 
1. Create an **empty directory where you are going to store attendance data**. 
2. Copy the script file to that directory. 
3. Open the script file in a text editor (Notepad in Windows). 
4. Make sure to set **dir_downloads** correctly. The default should work in Unix and macOs. Otherwise, if your Downloadds directory (or whatever directory Teams is saving the attendance lists to) is, say, 'C:/some/path', you can replace the line

    dir_downloads = os.path.expanduser('~') + '/Downloads'

with

    dir_downloads = 'C:/some/path'

5. There are also language-dependent settings for column headers used by Teams. Please, open your attendance lists/reports in a text editor to check what column headers appear there for:
* the full name, in attendance lists and reports,
* time mark (or event time), in attendance lists,
* join/leave time, in attendance reports,
* role, in attendance reports.
The defaults work in Polish.

6. You also need to specify in which columns this data can be found. Note that column numbers are 0-based, so 0 stands for the first column, 1 for the second, etc. The defaults should work, unless Teams changes its behaviour.

### 3. Create a schedule file.

This is also a one-time step. The schedule file is a simple text file with comma-separated values that contain information on your weekly schedule. Something like:

    Wednesday, 9:00, Linear algebra group 1
    Wednesday, 11:00, Linear algebra group 2
    Thursday, 9:00, Topology
    Thursday, 11:00, Topology
    Friday, 13:00, Linear algebra group 1
    Friday, 15:00, Linear algebra group 2

Note that:
* the same group can have multiple meetings on the same day or different days,
* you need to use the 24-hour format for times,
* weekday names should be in the system default language, see below.

The good news is that you do not need to create this file from scratch. 

1. Open the terminal (command prompt), go to the directory containing the script file, and run the script with:

    python3 attendance.py

You should get a new file **schedule.csv** with reasonable defaults, based on the lists/reports that you already have. Please, edit it to make sure that it is correct and complete, but do not change the default encoding. The last entry on each line, with '.csv' added, will be used as a file name for the csv file with attendance sheet. For instance, a schedule file as above means that the files **Linear algebra group 1.csv**, **Linear algebra group 2.csv** and **Topology.csv** in the current directory will be overwritten.

2. Correct the times in the schedule (these should be the start times of your classes).

3. Write the correct names of the classes instead of the placeholder values.

4. Add any missing entries.

### 4. Run the script.

Open the terminal (command prompt), go to the directory containing the script file, and run the script with:

    python3 attendance.py
    
With the **schedule.csv** in the current directory the script should process all the lists/reports that it can find in the Downloads directory. It will tell you which ones. Watch for any error reports.

Each meeting should be matched to the closest entry in the schedule, on the basis of the meeting start time. The maximum allowed distance is the greater of: 30 minutes, and the actual meeting length.
